<section class="appartement-list">
  <div class="container">
    <div class="appartement-list-container">
      <div class="appartement-list-header">
        <h2>Liste des biens</h2>
        <button
          class="{{filtresIsVisibles ? 'selected' : ''}}"
          (click)="toggleFiltres()">
          <span>{{filtresIsVisibles ? 'Fermer' : 'Statistiques'}} </span>
          <img src="assets/img/{{filtresIsVisibles ? 'close' : 'filtre'}}-icon.svg" alt="statistique icon">
        </button>
      </div>

      <ul class="appartement-list-filtres-list"
      *ngIf="filtresIsVisibles">
        <li class="appartement-list-filtres-item" *ngFor="let filtre of filtresList">
          <label>
            <input type="checkbox" [(ngModel)]="filtreActif[filtre.id]" (change)="toggleFiltre(filtre.id)" />
            {{ filtre.nom }}
          </label>
        </li>
      </ul>
      <ul class="appartement-list-list">
        <li
          class="appartement-list-item"
          *ngFor="let appartement of appartementListOverview"
          [ngClass]="{'selected': appartement.selected, 'selection-active': selectionMode}">
          <div
            class="appartement-list-item-container"
            *ngIf="appartement.id !== undefined"
            (click)="selectionMode ? toggleSelection(appartement) : viewAppartement(appartement.id)">
            <div class="appartement-list-item-contenu">
              <div>
                <h3>{{ appartement.numero }} {{ appartement.adresse }}</h3>
                <p>{{ appartement.codePostal }} {{ appartement.ville }}, {{appartement.pays.name}}</p>
              </div>
              <img src="./assets/img/view-more-icon.svg" alt="">
            </div>
            <ul class="appartement-list-filtres-selected-list">
              <li class="appartement-list-filtres-selected-item" *ngFor="let filtre of filtresList">
                <div *ngIf="filtreActif.includes(filtre.id) && filtre.id !== 'taux_occupation'">
                  <p><strong>{{ filtre.nom }}:</strong> {{ appartement[filtre.prop] | number:'1.2-2':'fr-FR' }} €</p>
                </div>
                <div *ngIf="filtreActif.includes(filtre.id) && filtre.id === 'taux_occupation'">
                  <p><strong>{{ filtre.nom }}:</strong> {{ 100 - appartement[filtre.prop] | number:'1.2-2':'fr-FR' }} %</p>
                </div>
              </li>
            </ul>
          </div>
        </li>
      </ul>
    </div>
    <div *ngIf="isProprietaire()" class="custom-card metriques {{appartementListOverview.length === 0 ? 'onload' : ''}}">
      <div *ngIf="this.appartementListOverview.length > 0" class="metriques-header">
        <h2>Chiffres clés</h2>
        <button
          class="cc-btn {{selectionMode ? 'selected' : ''}}"
          (click)="toggleSelectionMode()">
          <span>{{selectionMode ? 'Annuler' : 'Sélectionner'}} </span>
          <img src="assets/img/{{selectionMode ? 'close' : 'filtre'}}-icon.svg" alt="statistique icon">
        </button>
      </div>
      <div class="metriques-container" *ngIf="appartementListOverview.length > 0">
        <ul class="metriques-global-list">
          <li>
            <span>Valeur totale</span>
            <span class="chiffre">{{ totalCC.prixAchat | number:'1.2-2' }} €</span>
          </li>
          <li>
            <span>Estimation totale</span>
            <span class="chiffre">{{ totalCC.estimation | number:'1.2-2' }} €</span>
          </li>
          <li>
            <span>Revenus totaux</span>
            <span class="chiffre">{{ totalCC.revenusNets | number:'1.2-2' }} €</span>
          </li>
          <li>
            <span>Dépenses totales</span>
            <span class="chiffre">{{ totalCC.depensesNettes | number:'1.2-2' }} €</span>
          </li>
          <li>
            <span>Bénéfice net</span>
            <span class="chiffre">{{ totalCC.revenusNets - totalCC.depensesNettes | number:'1.2-2' }} €</span>
          </li>
          <li>
            <span>Taux de provision</span>
            <span class="chiffre">{{ totalCC.depensesNettes / totalCC.revenusNets * 100 | number:'1.2-2' }} %</span>
          </li>
        </ul>
      </div>
      <img class="loader" *ngIf="appartementListOverview.length === 0" ngSrc="assets/img/loader.gif" alt="loader"
           height="331" width="336">
    </div>
  </div>
</section>
